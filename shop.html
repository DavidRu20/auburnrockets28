<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AHS Class of ’28 — Shop</title>
  <meta name="theme-color" content="#0d6efd" />
  <link rel="stylesheet" href="styles.css?v=24" />
  <style>
    body { color: var(--text); background: transparent; overflow-x:hidden; }
    #starfield{ position: fixed; inset: 0; z-index:-1; }
    main{ max-width: 1200px; margin: 0 auto; padding: 22px 18px 40px; }

    /* Toolbar */
    .shop-toolbar{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:16px;
    }
    .shop-toolbar .input{ max-width: 360px; }

    /* Grid */
    .shop-grid{ display:grid; gap:14px; grid-template-columns: repeat(3, minmax(0,1fr)); }
    @media (max-width: 960px){ .shop-grid{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 560px){ .shop-grid{ grid-template-columns: 1fr; } }

    /* Card specifics (uses your .panel + .product styles) */
    .product-card .title{ font-weight: 800; margin: 8px 0 4px; }
    .product-card .price{ font-weight: 800; }
    .product-card .meta{ font-size: 12px; color: var(--muted); }
    .product-card .actions{ display:flex; gap:8px; margin-top:10px; }
    .product-card img { aspect-ratio: 4/3; object-fit: cover; width:100%; }

    .empty-msg{
      text-align:center; opacity:.8; padding:30px 10px;
      border:1px dashed var(--border); border-radius:14px;
    }
  </style>
</head>
<body>
  <canvas id="starfield"></canvas>

  <!-- Header -->
  <header class="header" role="banner">
    <nav class="nav" aria-label="Primary">
      <a class="brand" href="./" aria-label="AHS Class of 2028 — Home">
        <span class="logo" aria-hidden="true">A</span>
        AHS Class of ’28
      </a>
      <div class="links" role="navigation">
        <a href="./">Home</a>
        <a href="./fundraisers.html">Fundraisers</a>
        <a href="./calendar.html">Calendar</a>
        <a href="./media.html">Media</a>
        <a href="./achievements.html">Achievements</a>
        <a href="./about.html">About</a>
        <a href="./contact.html">Contact</a>
        <a class="active" href="./shop.html">Shop</a>
        <a href="./announcements.html">Announcements</a>
        <a href="./community.html">Community</a>
      </div>
      <button id="menuBtn" class="menu-btn" aria-expanded="false"
              aria-controls="mobileMenu" aria-label="Open menu">☰</button>
    </nav>
    <div id="mobileMenu" class="mobile-menu hidden" role="dialog" aria-modal="true" aria-label="Mobile navigation">
      <a href="./">Home</a>
      <a href="./fundraisers.html">Fundraisers</a>
      <a href="./calendar.html">Calendar</a>
      <a href="./media.html">Media</a>
      <a href="./achievements.html">Achievements</a>
      <a href="./about.html">About</a>
      <a href="./contact.html">Contact</a>
      <a class="active" href="./shop.html">Shop</a>
      <a href="./announcements.html">Announcements</a>
      <a href="./community.html">Community</a>
      <div class="small" style="padding:8px 10px; opacity:.8">Tap outside to close</div>
    </div>
  </header>

  <main>
    <h1>Shop</h1>
    <p class="small" style="margin-top:-6px">All profits support AHS Class of ’28.</p>

    <!-- Toolbar -->
    <div class="shop-toolbar">
      <input id="q" class="input" type="search" placeholder="Search hoodies, tees, hats…" aria-label="Search products">
      <select id="cat" class="select" aria-label="Filter by category">
        <option value="">All categories</option>
        <option value="hoodie">Hoodies</option>
        <option value="jersey">Jerseys</option>
        <option value="tee">T-Shirts</option>
        <option value="hat">Hats</option>
        <option value="pants">Pants</option>
      </select>
    </div>

    <!-- Grid -->
    <div id="grid" class="shop-grid"></div>
    <div id="empty" class="empty-msg hidden">No items match that filter.</div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="small">Built for AHS Class of 2028 • Edit items in <code>data/products.json</code></div>
    </div>
  </footer>

  <script>
    /* Mobile menu */
    (function(){
      const btn = document.getElementById('menuBtn');
      const menu = document.getElementById('mobileMenu');
      if (!btn || !menu) return;
      btn.addEventListener('click', e=>{
        e.stopPropagation();
        const hidden = menu.classList.toggle('hidden');
        btn.setAttribute('aria-expanded', String(!hidden));
      });
      document.addEventListener('click', e=>{
        if (!menu.classList.contains('hidden') && !menu.contains(e.target) && e.target !== btn){
          btn.setAttribute('aria-expanded','false'); menu.classList.add('hidden');
        }
      });
    })();

    /* Starfield */
    (function(){
      const cvs = document.getElementById('starfield');
      const ctx = cvs.getContext('2d', { alpha:false });
      let stars=[];
      function resize(){ cvs.width=innerWidth; cvs.height=innerHeight;
        stars = Array.from({length:200},()=>({x:Math.random()*cvs.width,y:Math.random()*cvs.height,r:Math.random()*1.6,v:Math.random()*0.3+0.05}));
      }
      addEventListener('resize', resize); resize();
      (function tick(){
        const light = document.documentElement.getAttribute('data-theme')==='light';
        const g = ctx.createLinearGradient(0,0,0,cvs.height);
        if(light){ g.addColorStop(0,'#eaf2ff'); g.addColorStop(1,'#ffffff'); }
        else{ g.addColorStop(0,'#0b0e1a'); g.addColorStop(1,'#000'); }
        ctx.fillStyle=g; ctx.fillRect(0,0,cvs.width,cvs.height);
        ctx.fillStyle = light? 'rgba(60,90,140,.85)':'rgba(180,200,255,.85)';
        for(const s of stars){ ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill(); s.y+=s.v; if(s.y>cvs.height){ s.y=-2; s.x=Math.random()*cvs.width; } }
        requestAnimationFrame(tick);
      })();
    })();

    /* ===== SHOP RENDER ===== */
    const DATA_URL = 'data/products.json';
    const grid = document.getElementById('grid');
    const empty = document.getElementById('empty');
    const q = document.getElementById('q');
    const cat = document.getElementById('cat');
    let items = [];

    function fmtPrice(n){ return `$${Number(n).toFixed(2)}`; }

    function render(){
      grid.innerHTML = '';
      const term = (q.value||'').toLowerCase().trim();
      const category = cat.value;

      const filtered = items.filter(p=>{
        const t = (p.title+' '+(p.tags||[]).join(' ')+' '+(p.desc||'')).toLowerCase();
        const okTerm = !term || t.includes(term);
        const okCat = !category || p.category === category;
        return okTerm && okCat;
      });

      if (!filtered.length){ empty.classList.remove('hidden'); return; }
      empty.classList.add('hidden');

      for(const p of filtered){
        const card = document.createElement('a');
        card.href = p.link || '#';
        card.className = 'panel hover-up product product-card';
        card.setAttribute('aria-label', p.title);

        // chip(s)
        const chips = document.createElement('div');
        chips.className = 'chips';
        if (p.badge) {
          const b = document.createElement('span');
          b.className = 'badge blue'; b.textContent = p.badge;
          chips.appendChild(b);
        }
        card.appendChild(chips);

        // media
        const media = document.createElement('div');
        media.className = 'media-item';
        const img = document.createElement('img');
        img.loading = 'lazy';
        img.src = p.image;
        img.alt = p.alt || p.title;
        media.appendChild(img);
        card.appendChild(media);

        // text
        const h3 = document.createElement('div');
        h3.className = 'title'; h3.textContent = p.title;
        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.textContent = (p.colors? p.colors.join(', ')+' • ' : '') + (p.sizes? p.sizes.join(', ') : '');
        const price = document.createElement('div');
        price.className = 'price'; price.textContent = fmtPrice(p.price);

        // actions
        const actions = document.createElement('div');
        actions.className = 'actions';
        const buy = document.createElement('button');
        buy.className = 'btn primary';
        buy.type='button';
        buy.textContent = p.cta || 'Buy';
        buy.addEventListener('click', (e)=>{ e.preventDefault(); location.href = p.link || '#'; });
        actions.appendChild(buy);

        if (p.file){
          const dl = document.createElement('a');
          dl.className = 'btn';
          dl.href = p.file; dl.textContent = 'Sizing';
          actions.appendChild(dl);
        }

        card.appendChild(h3); card.appendChild(meta); card.appendChild(price); card.appendChild(actions);
        grid.appendChild(card);
      }
    }

    q.addEventListener('input', render);
    cat.addEventListener('change', render);

    fetch(DATA_URL, { cache:'no-store' })
      .then(r=>r.ok?r.json():[])
      .then(list => { items = Array.isArray(list)? list : []; })
      .catch(()=>{ items = []; })
      .finally(render);
  </script>

  <script src="script.js?v=24"></script>
</body>
</html>
