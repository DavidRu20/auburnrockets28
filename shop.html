<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AHS Class of ’28 — Shop</title>
  <meta name="theme-color" content="#0d6efd" />
  <link rel="stylesheet" href="styles.css?v=26" />
  <style>
    body { color: var(--text); background: transparent; overflow-x:hidden; }
    #starfield{ position: fixed; inset: 0; z-index:-1; }
    main{ max-width: 1220px; margin: 0 auto; padding: 26px 18px 44px; }

    /* Notice */
    .concept-banner{
      display:flex; gap:10px; align-items:flex-start;
      padding: 14px 16px; border-radius: 14px;
      background: linear-gradient(135deg, #2b8cff22, #ffffff10);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-1);
      margin: 8px 0 18px;
      backdrop-filter: blur(10px);
    }
    .concept-banner .icon{
      width: 28px; height: 28px; border-radius: 8px;
      display:grid; place-items:center;
      background: linear-gradient(135deg, var(--yellow), var(--yellow-2));
      color:#000; font-weight:900;
    }

    /* Toolbar */
    .shop-toolbar{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-bottom:14px;
    }
    .pillbar{ display:flex; gap:8px; flex-wrap:wrap; }
    .pill{
      border:1px solid var(--border); background: var(--panel);
      padding:6px 10px; border-radius:999px; font-weight:700; font-size:13px;
      opacity:.9; cursor:pointer; user-select:none;
      transition: transform var(--t-fast), background var(--t-fast);
    }
    .pill:hover{ transform: translateY(-1px); }
    .pill.active{ background: linear-gradient(135deg, var(--blue), var(--blue-2)); color:#fff; border-color:transparent; }
    .tool-gap{ flex:1 1 auto; }

    .input{ max-width: 360px; }
    .select{ width: 200px; }

    /* Grid + cards */
    .shop-grid{
      display:grid; gap:16px;
      grid-template-columns: repeat(4, minmax(0,1fr));
    }
    @media (max-width: 1100px){ .shop-grid{ grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 820px){ .shop-grid{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 540px){ .shop-grid{ grid-template-columns: 1fr; } }

    .card.product{
      padding: 0; overflow: hidden;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid var(--border);
    }
    .product-media{ position: relative; aspect-ratio: 4/3; overflow:hidden; border-bottom:1px solid var(--border); }
    .product-media img{ width:100%; height:100%; object-fit:cover; transform: scale(1.001); transition: transform 600ms cubic-bezier(.2,.8,.2,1); }
    .card.product:hover .product-media img{ transform: scale(1.04); }

    .product-body{ padding: 14px; display:grid; gap:8px; }
    .title-row{ display:flex; justify-content:space-between; gap:8px; align-items:center; }
    .product-title{ font-weight:900; line-height:1.1; }
    .price{ font-weight:900; }
    .meta{ font-size:12px; color: var(--muted); }
    .actions{ display:flex; gap:8px; }
    .actions .btn{ flex:1 1 0; height:40px; }

    .empty-msg{ text-align:center; opacity:.85; padding:30px 10px; border:1px dashed var(--border); border-radius:14px; margin-top:10px; }
  </style>
</head>
<body>
  <canvas id="starfield"></canvas>

  <!-- Header -->
  <header class="header" role="banner">
    <nav class="nav" aria-label="Primary">
      <a class="brand" href="./" aria-label="AHS Class of 2028 — Home">
        <span class="logo" aria-hidden="true">A</span>
        AHS Class of ’28
      </a>
      <div class="links" role="navigation">
        <a href="./">Home</a>
        <a href="./fundraisers.html">Fundraisers</a>
        <a href="./calendar.html">Calendar</a>
        <a href="./media.html">Media</a>
        <a href="./achievements.html">Achievements</a>
        <a href="./about.html">About</a>
        <a href="./contact.html">Contact</a>
        <a class="active" href="./shop.html">Shop</a>
        <a href="./announcements.html">Announcements</a>
        <a href="./community.html">Community</a>
      </div>
      <button id="menuBtn" class="menu-btn" aria-expanded="false"
              aria-controls="mobileMenu" aria-label="Open menu">☰</button>
    </nav>
    <div id="mobileMenu" class="mobile-menu hidden" role="dialog" aria-modal="true" aria-label="Mobile navigation">
      <a href="./">Home</a><a href="./fundraisers.html">Fundraisers</a><a href="./calendar.html">Calendar</a>
      <a href="./media.html">Media</a><a href="./achievements.html">Achievements</a><a href="./about.html">About</a>
      <a href="./contact.html">Contact</a><a class="active" href="./shop.html">Shop</a><a href="./announcements.html">Announcements</a><a href="./community.html">Community</a>
      <div class="small" style="padding:8px 10px; opacity:.8">Tap outside to close</div>
    </div>
  </header>

  <main>
    <h1>Shop</h1>

    <!-- Concept notice -->
    <div class="concept-banner">
      <div class="icon">!</div>
      <div>
        <strong>Concept Only:</strong> this shop is an idea and items have not yet been approved.
        If you’re interested or have feedback, please
        <a href="./contact.html" class="badge blue" style="vertical-align:middle;">contact us</a>.
      </div>
    </div>

    <!-- Toolbar -->
    <div class="shop-toolbar">
      <div class="pillbar" id="pillbar"></div>
      <div class="tool-gap"></div>
      <input id="q" class="input" type="search" placeholder="Search hoodies, tees, hats…" aria-label="Search products">
      <select id="sort" class="select" aria-label="Sort">
        <option value="new">Newest</option>
        <option value="price-asc">Price: Low → High</option>
        <option value="price-desc">Price: High → Low</option>
      </select>
    </div>

    <!-- Grid -->
    <div id="grid" class="shop-grid"></div>
    <div id="empty" class="empty-msg hidden">No items match your filters.</div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="small">Built for AHS Class of 2028 • Edit items in <code>data/products.json</code> (or just drop images into <code>images/shop</code>)</div>
    </div>
  </footer>

  <script>
    /* ===== CONFIG: set your GitHub repo for API fallback ===== */
    const GITHUB_USER = 'YOUR_USERNAME';   // <-- change this
    const GITHUB_REPO = 'YOUR_REPO_NAME';  // <-- change this
    const SHOP_FOLDER = 'images/shop';     // folder that holds the product images
    const PRODUCTS_JSON = 'data/products.json'; // preferred data source

    /* Mobile menu */
    (function(){
      const btn = document.getElementById('menuBtn');
      const menu = document.getElementById('mobileMenu');
      if (!btn || !menu) return;
      btn.addEventListener('click', e=>{
        e.stopPropagation();
        const hidden = menu.classList.toggle('hidden');
        btn.setAttribute('aria-expanded', String(!hidden));
      });
      document.addEventListener('click', e=>{
        if (!menu.classList.contains('hidden') && !menu.contains(e.target) && e.target !== btn){
          btn.setAttribute('aria-expanded','false'); menu.classList.add('hidden');
        }
      });
    })();

    /* Starfield */
    (function(){
      const cvs = document.getElementById('starfield');
      const ctx = cvs.getContext('2d', { alpha:false });
      let stars=[];
      function resize(){ cvs.width=innerWidth; cvs.height=innerHeight;
        stars = Array.from({length:200},()=>({x:Math.random()*cvs.width,y:Math.random()*cvs.height,r:Math.random()*1.6,v:Math.random()*0.3+0.05}));
      }
      addEventListener('resize', resize); resize();
      (function tick(){
        const light = document.documentElement.getAttribute('data-theme')==='light';
        const g = ctx.createLinearGradient(0,0,0,cvs.height);
        if(light){ g.addColorStop(0,'#eaf2ff'); g.addColorStop(1,'#ffffff'); }
        else{ g.addColorStop(0,'#0b0e1a'); g.addColorStop(1,'#000'); }
        ctx.fillStyle=g; ctx.fillRect(0,0,cvs.width,cvs.height);
        ctx.fillStyle = light? 'rgba(60,90,140,.85)':'rgba(180,200,255,.85)';
        for(const s of stars){ ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill(); s.y+=s.v; if(s.y>cvs.height){ s.y=-2; s.x=Math.random()*cvs.width; } }
        requestAnimationFrame(tick);
      })();
    })();

    /* ===== SHOP LOGIC (JSON first, GitHub API fallback) ===== */
    const grid = document.getElementById('grid');
    const empty = document.getElementById('empty');
    const q = document.getElementById('q');
    const sortSel = document.getElementById('sort');
    const pillbar = document.getElementById('pillbar');

    let items = [];          // unified list of products
    let activeCat = '';      // pill filter
    const CATEGORY_LABELS = { hoodie:'Hoodies', jersey:'Jerseys', tee:'T-Shirts', hat:'Hats', pants:'Pants', other:'Other' };

    function fmtPrice(n){ return typeof n==='number' ? `$${Number(n).toFixed(2)}` : ''; }

    function buildPills(){
      const cats = Array.from(new Set(items.map(i=>i.category || 'other'))).filter(Boolean);
      pillbar.innerHTML = '';
      const all = document.createElement('button');
      all.className = 'pill' + (activeCat===''?' active':'');
      all.textContent = 'All';
      all.addEventListener('click', ()=>{ activeCat=''; render(); buildPills(); });
      pillbar.appendChild(all);
      cats.forEach(c=>{
        const b = document.createElement('button');
        b.className = 'pill' + (activeCat===c?' active':'');
        b.textContent = CATEGORY_LABELS[c] || c;
        b.addEventListener('click', ()=>{ activeCat=c; render(); buildPills(); });
        pillbar.appendChild(b);
      });
    }

    function render(){
      const term = (q.value||'').toLowerCase().trim();
      const sort = sortSel.value;

      let list = items.filter(p=>{
        const inCat = !activeCat || (p.category||'other') === activeCat;
        const hay = (p.title+' '+(p.tags||[]).join(' ')+' '+(p.desc||'')+' '+(p.colors||[]).join(' ')+' '+(p.sizes||[]).join(' ')).toLowerCase();
        const inTerm = !term || hay.includes(term);
        return inCat && inTerm;
      });

      // sort
      if (sort === 'price-asc') list.sort((a,b)=> (a.price||0) - (b.price||0));
      else if (sort === 'price-desc') list.sort((a,b)=> (b.price||0) - (a.price||0));
      else list.sort((a,b)=> (b.created||0) - (a.created||0)); // newest first if provided

      grid.innerHTML = '';
      if (!list.length){ empty.classList.remove('hidden'); return; }
      empty.classList.add('hidden');

      list.forEach(p=>{
        const card = document.createElement('div');
        card.className = 'card hover-up product';

        // media
        const media = document.createElement('div');
        media.className = 'product-media';
        const img = document.createElement('img');
        img.loading='lazy'; img.src = p.image; img.alt = p.alt || p.title;
        media.appendChild(img);

        // top-left badge
        const chips = document.createElement('div');
        chips.className = 'chips';
        chips.style.position='absolute'; chips.style.top='10px'; chips.style.left='10px';
        if (p.badge){
          const b = document.createElement('span');
          b.className = 'badge blue'; b.textContent = p.badge;
          chips.appendChild(b);
        }
        media.appendChild(chips);

        // body
        const body = document.createElement('div'); body.className = 'product-body';
        const row = document.createElement('div'); row.className = 'title-row';
        const title = document.createElement('div'); title.className = 'product-title'; title.textContent = p.title;
        const price = document.createElement('div'); price.className = 'price'; price.textContent = fmtPrice(p.price);
        row.appendChild(title); row.appendChild(price);

        const meta = document.createElement('div'); meta.className = 'meta';
        const colors = (p.colors && p.colors.length)? p.colors.join(', ') : '';
        const sizes  = (p.sizes  && p.sizes.length)? p.sizes.join(', ')  : '';
        meta.textContent = [colors, sizes].filter(Boolean).join(' • ');

        const actions = document.createElement('div'); actions.className = 'actions';
        const buy = document.createElement('a'); buy.className = 'btn primary'; buy.textContent = p.cta || 'Buy';
        buy.href = p.link || './contact.html';
        const interest = document.createElement('a'); interest.className = 'btn'; interest.textContent = 'I’m interested';
        const subject = encodeURIComponent('Product interest: ' + p.title);
        interest.href = `./contact.html?subject=${subject}`;
        actions.appendChild(buy); actions.appendChild(interest);

        body.appendChild(row); body.appendChild(meta); body.appendChild(actions);
        card.appendChild(media); card.appendChild(body);
        grid.appendChild(card);
      });
    }

    async function loadFromJSON(){
      const res = await fetch(PRODUCTS_JSON, { cache:'no-store' });
      if (!res.ok) throw new Error('no products.json');
      const data = await res.json();
      if (!Array.isArray(data)) throw new Error('bad products.json');
      return data;
    }

    async function loadFromGitHubAPI(){
      // Build URL for GitHub Contents API (public repos only)
      const url = `https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${SHOP_FOLDER}`;
      const res = await fetch(url, { headers: { 'Accept': 'application/vnd.github+json' }});
      if (!res.ok) throw new Error('GitHub API failed');
      const files = await res.json();
      // Map each image into a basic product card
      const imgs = files.filter(f => f.type==='file' && /\.(png|jpe?g|webp|gif)$/i.test(f.name));
      return imgs.map(f => ({
        id: f.sha,
        title: f.name.replace(/\.[^.]+$/, '').replace(/[-_]+/g,' ').replace(/\s+/g,' ').trim(), // filename → title
        category: 'other',
        price: null,
        image: f.download_url,  // raw file URL from GitHub
        alt: f.name,
        link: './contact.html',
        badge: 'Concept'
      }));
    }

    (async function start(){
      try{
        // Try JSON first (nice titles/prices/categories)
        items = await loadFromJSON();
      }catch{
        // Fallback: auto-gallery from GitHub folder
        items = await loadFromGitHubAPI();
      }
      // optional: assign created timestamps so "Newest" works
      const now = new Date();
      items.forEach((p,i)=>{ if (!p.created) p.created = Number(now.toISOString().slice(0,10).replace(/-/g,'')) - i; });
      buildPills(); render();

      // listeners
      q.addEventListener('input', render);
      sortSel.addEventListener('change', render);
    })();
  </script>

  <script src="script.js?v=26"></script>
</body>
</html>
