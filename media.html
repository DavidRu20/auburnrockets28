<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Media • AHS Class of ’28</title>
  <meta name="theme-color" content="#0d6efd" />
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* --- page-local styles --- */
    .media-toolbar{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:12px;
    }
    .media-toolbar .tabs{ display:flex; gap:8px; flex-wrap:wrap; }
    .tab-btn{
      padding:8px 12px; border:1px solid var(--border); border-radius:999px;
      background:var(--panel); color:var(--muted); font-weight:700; cursor:pointer;
      transition:transform var(--t-base), box-shadow var(--t-base), background var(--t-base);
    }
    .tab-btn[aria-pressed="true"]{ background:linear-gradient(135deg,#0d6efd,#2b8cff); color:#fff; border-color:transparent; }
    .media-search{ flex:1; min-width:200px; }
    .media-search input{
      width:100%; padding:10px 12px; border:1px solid var(--border); border-radius:12px; background:var(--panel); color:var(--text);
    }

    /* Masonry-ish photo grid (pure CSS columns) */
    .masonry{ column-count: 3; column-gap: 14px; }
    .masonry .m-item{
      break-inside: avoid; margin: 0 0 14px 0; display:block; position:relative;
      border-radius:14px; overflow:hidden; box-shadow: var(--shadow-1);
      background: var(--panel);
      transition: transform var(--t-base), box-shadow var(--t-base);
    }
    .masonry .m-item:hover{ transform: translateY(-3px); box-shadow: var(--shadow-2); }
    .masonry img{ width:100%; height:auto; display:block; }
    .m-cap{
      position:absolute; left:0; right:0; bottom:0; padding:8px 10px;
      background: linear-gradient(180deg, transparent, rgba(0,0,0,.55));
      color:#fff; font-size:12px;
    }
    @media (max-width: 980px){ .masonry{ column-count: 2; } }
    @media (max-width: 640px){ .masonry{ column-count: 1; } }

    /* Video grid (YT cards) */
    .video-grid{ display:grid; gap:14px; grid-template-columns: repeat(3, minmax(0,1fr)); }
    .video-card{
      border-radius:14px; overflow:hidden; background:var(--panel); box-shadow: var(--shadow-1);
      transition: transform var(--t-base), box-shadow var(--t-base);
    }
    .video-card:hover{ transform: translateY(-3px); box-shadow: var(--shadow-2); }
    .video-thumb{ position:relative; aspect-ratio:16/9; overflow:hidden; }
    .video-thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
    .video-body{ padding:10px 12px; }
    .video-title{ font-weight:800; margin-bottom:4px; }
    .video-meta{ font-size:12px; color:var(--muted); }
    @media (max-width:980px){ .video-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
    @media (max-width:640px){ .video-grid{ grid-template-columns: 1fr; } }

    /* Lightbox / modal */
    .lightbox, .modal{
      position:fixed; inset:0; display:none; place-items:center; padding:20px;
      background: rgba(0,0,0,.6); backdrop-filter: blur(4px); z-index:9999;
    }
    .lightbox.open, .modal.open{ display:grid; }
    .lb-content, .modal-content{
      max-width:min(96vw,1100px); max-height:86vh; background:var(--panel); border-radius:16px; overflow:hidden; box-shadow: var(--shadow-2);
    }
    .lb-img{ max-height:86vh; display:block; }
    .modal-head{ display:flex; justify-content:space-between; align-items:center; padding:10px 14px; border-bottom:1px solid var(--border); }
    .modal-body{ padding:0; }
    .x-btn{ background:transparent; border:0; font-size:22px; cursor:pointer; color:var(--text); }

    /* Visually hide when section is not active (for tab UX) */
    .is-hidden{ display:none; }
  </style>
</head>
<body>

  <!-- ============================ HEADER / NAV ============================ -->
<header class="header" role="banner">
  <nav class="nav" aria-label="Primary">
    <a class="brand" href="./" aria-label="AHS Class of 2028 — Home">
      <span class="logo" aria-hidden="true">A</span>
      AHS Class of ’28
    </a>

    <div class="links" role="navigation">
      <a href="./index.html">Home</a>
      <a href="./fundraisers.html">Fundraisers</a>
      <a href="./calendar.html">Calendar</a>
      <a href="./media.html" aria-current="page">Media</a>
      <a href="./achievements.html">Achievements</a>
      <a href="./about.html">About</a>
      <a href="./contact.html">Contact</a>
      <a href="./shop.html">Shop</a>
      <a href="./announcements.html">Announcements</a>
      <a href="./community.html">Community</a>
    </div>

    <button id="menuBtn" class="menu-btn" aria-expanded="false"
            aria-controls="mobileMenu" aria-label="Open menu">☰</button>
  </nav>

  <div id="mobileMenu" class="mobile-menu hidden" role="dialog" aria-modal="true" aria-label="Mobile navigation">
    <a href="./">Home</a>
    <a href="./fundraisers.html">Fundraisers</a>
    <a href="./calendar.html">Calendar</a>
    <a href="./media.html" aria-current="page">Media</a>
    <a href="./achievements.html">Achievements</a>
    <a href="./about.html">About</a>
    <a href="./contact.html">Contact</a>
    <a href="./shop.html">Shop</a>
    <a href="./announcements.html">Announcements</a>
    <a href="./community.html">Community</a>
    <div class="small" style="padding:8px 10px; opacity:.8">Tap outside to close</div>
  </div>
</header>

  <main>
    <!-- ============================== HERO ================================= -->
    <section class="hero" aria-labelledby="mediaTitle">
      <div class="card hover-up" style="max-width:920px; margin-inline:auto;">
        <h1 id="mediaTitle">Media</h1>
        <p class="small" style="margin-top:6px;">Instagram-style photo grid • YouTube-style video cards • Easy submissions</p>
        <div class="inline" style="justify-content:center; margin-top:14px;">
          <a class="btn" href="./contact.html">Submit a photo/video</a>
        </div>
      </div>
    </section>

    <!-- ============================== TOOLBAR =============================== -->
    <section class="section">
      <div class="container">
        <div class="media-toolbar">
          <div class="tabs" role="tablist" aria-label="Media type">
            <button class="tab-btn" data-tab="all" aria-pressed="true">All</button>
            <button class="tab-btn" data-tab="photos" aria-pressed="false">Photos</button>
            <button class="tab-btn" data-tab="videos" aria-pressed="false">Videos</button>
          </div>
          <div class="media-search">
            <input id="mediaSearch" type="search" placeholder="Search captions, titles…" aria-label="Search media" />
          </div>
        </div>

        <!-- Photos -->
        <article id="photosSection" class="panel glass hover-up" aria-labelledby="photosTitle">
          <h2 id="photosTitle" class="section-title">Photos</h2>
          <div id="photoGrid" class="masonry" aria-live="polite"></div>
          <div id="photoEmpty" class="small" style="color:var(--muted); display:none; padding:8px 2px;">No photos match.</div>
        </article>

        <!-- Videos -->
        <article id="videosSection" class="panel glass hover-up" aria-labelledby="videosTitle" style="margin-top:16px;">
          <h2 id="videosTitle" class="section-title">Videos</h2>
          <div id="videoGrid" class="video-grid" aria-live="polite"></div>
          <div id="videoEmpty" class="small" style="color:var(--muted); display:none; padding:8px 2px;">No videos match.</div>
        </article>
      </div>
    </section>
  </main>

  <!-- ============================= FOOTER ================================ -->
  <footer class="footer">
    <div class="container">
      <div class="small">
        AHS Class of ’28 • Media
      </div>
    </div>
  </footer>

  <!-- Lightbox for photos -->
  <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="Photo viewer">
    <div class="lb-content">
      <img id="lbImg" class="lb-img" alt="" />
    </div>
  </div>

  <!-- Modal for videos -->
  <div id="videoModal" class="modal" role="dialog" aria-modal="true" aria-label="Video viewer">
    <div class="modal-content">
      <div class="modal-head">
        <div id="vmTitle" class="video-title">Video</div>
        <button id="vmClose" class="x-btn" aria-label="Close">✕</button>
      </div>
      <div class="modal-body">
        <div id="vmFrame" style="position:relative; aspect-ratio:16/9;"></div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast info hidden" role="status" aria-live="polite"></div>

  <!-- Page-only script (keeps your main script.js untouched) -->
  <script defer>
  (function mediaPage(){
    const DATA_URL = "data/media.json?v=" + Date.now().toString().slice(0,10);

    const photoGrid = document.getElementById('photoGrid');
    const videoGrid = document.getElementById('videoGrid');
    const photoEmpty = document.getElementById('photoEmpty');
    const videoEmpty = document.getElementById('videoEmpty');
    const photosSection = document.getElementById('photosSection');
    const videosSection = document.getElementById('videosSection');
    const tabs = Array.from(document.querySelectorAll('.tab-btn'));
    const searchInput = document.getElementById('mediaSearch');

    const lightbox = document.getElementById('lightbox');
    const lbImg = document.getElementById('lbImg');
    const videoModal = document.getElementById('videoModal');
    const vmTitle = document.getElementById('vmTitle');
    const vmClose = document.getElementById('vmClose');
    const vmFrame = document.getElementById('vmFrame');

    let all = { photos:[], videos:[] };
    let activeTab = 'all';
    let query = '';
    let lbIndex = -1; // for arrow navigation

    const esc = (s)=> String(s||'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    const yoid = (val)=> {
      // extract safe YouTube Video ID (11 chars)
      if (!val) return '';
      let id = String(val).trim();
      id = id.replace(/.*(?:v=|\/embed\/|\.be\/)/,'').split(/[?&]/)[0];
      return /^[\w-]{11}$/.test(id) ? id : '';
    };

    function cardPhoto(p, idx){
      const cap = esc(p.caption || '');
      const src = esc(p.src);
      const alt = esc(p.alt || p.caption || 'Photo');
      const tag = (p.tags || []).map(t=>`#${esc(t)}`).join(' ');
      return `
        <a href="${src}" class="m-item" data-idx="${idx}" data-photo="${src}" data-alt="${alt}">
          <img src="${src}" alt="${alt}" loading="lazy" decoding="async" onerror="this.style.opacity=0;this.parentElement.style.display='none'">
          <div class="m-cap">${cap} ${tag ? '• '+tag : ''}</div>
        </a>`;
    }

    function cardVideo(v){
      const id = yoid(v.youtube);
      const thumb = esc(v.thumb || `https://img.youtube.com/vi/${id}/hqdefault.jpg`);
      const title = esc(v.title || 'Video');
      const meta = esc(v.meta || '');
      return `
        <article class="video-card" data-youtube="${id}" data-title="${title}" tabindex="0" role="button" aria-label="Open video ${title}">
          <div class="video-thumb"><img src="${thumb}" alt="${title}" loading="lazy" decoding="async"></div>
          <div class="video-body">
            <div class="video-title">${title}</div>
            <div class="video-meta">${meta}</div>
          </div>
        </article>`;
    }

    function matchQuery(text){
      return !query || text.toLowerCase().includes(query.toLowerCase());
    }

    function render(){
      // Photos
      const photos = all.photos.filter(p => {
        const hay = [p.caption, (p.tags||[]).join(' ')].join(' ');
        return (activeTab === 'all' || activeTab === 'photos') && matchQuery(hay);
      });
      photoGrid.innerHTML = photos.map((p,i)=>cardPhoto(p,i)).join('');
      photoEmpty.style.display = photos.length ? 'none':'block';

      // Videos
      const videos = all.videos.filter(v => {
        const hay = [v.title, v.meta, (v.tags||[]).join(' ')].join(' ');
        return (activeTab === 'all' || activeTab === 'videos') && matchQuery(hay);
      });
      videoGrid.innerHTML = videos.map(cardVideo).join('');
      videoEmpty.style.display = videos.length ? 'none':'block';

      // Section visibility based on tab
      photosSection.classList.toggle('is-hidden', activeTab === 'videos');
      videosSection.classList.toggle('is-hidden', activeTab === 'photos');

      wireLightbox(photos);
      wireVideoModal();
    }

    function wireLightbox(currentList){
      const anchors = [...photoGrid.querySelectorAll('[data-photo]')];
      anchors.forEach(a=>{
        a.addEventListener('click', (e)=>{
          e.preventDefault();
          lbIndex = Number(a.getAttribute('data-idx'));
          openLightbox(currentList[lbIndex]?.src, currentList[lbIndex]?.alt);
        });
        a.addEventListener('keydown', (e)=>{
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); a.click(); }
        });
      });

      function openLightbox(src, alt){
        lbImg.src = src;
        lbImg.alt = alt || 'Photo';
        lightbox.classList.add('open');
        document.body.style.overflow = 'hidden';
        lightbox.focus();
      }
      function closeLightbox(){
        lightbox.classList.remove('open');
        lbImg.src = '';
        document.body.style.overflow = '';
      }
      lightbox.addEventListener('click', (e)=> { if(e.target === lightbox) closeLightbox(); });
      document.addEventListener('keydown', (e)=>{
        if(!lightbox.classList.contains('open')) return;
        if (e.key === 'Escape') closeLightbox();
        if (e.key === 'ArrowRight' && currentList.length){
          lbIndex = (lbIndex + 1) % currentList.length;
          lbImg.src = currentList[lbIndex].src;
        }
        if (e.key === 'ArrowLeft' && currentList.length){
          lbIndex = (lbIndex - 1 + currentList.length) % currentList.length;
          lbImg.src = currentList[lbIndex].src;
        }
      });
    }

    function wireVideoModal(){
      const cards = [...videoGrid.querySelectorAll('[data-youtube]')];
      const open = (card)=>{
        const id = card.getAttribute('data-youtube');
        if (!id) return;
        const title = card.getAttribute('data-title') || 'Video';
        vmTitle.textContent = title;
        vmFrame.innerHTML = `
          <iframe width="100%" height="100%" src="https://www.youtube.com/embed/${id}?autoplay=1"
            title="${title}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen></iframe>`;
        videoModal.classList.add('open');
        document.body.style.overflow = 'hidden';
        vmClose.focus();
      };
      const close = ()=>{
        videoModal.classList.remove('open');
        vmFrame.innerHTML = "";
        document.body.style.overflow = '';
      };

      cards.forEach(card=>{
        card.addEventListener('click', ()=> open(card));
        card.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); open(card); }});
      });
      vmClose.addEventListener('click', close);
      videoModal.addEventListener('click', (e)=>{ if (e.target === videoModal) close(); });
      document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape' && videoModal.classList.contains('open')) close(); });
    }

    // Tabs
    tabs.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        tabs.forEach(b=> b.setAttribute('aria-pressed','false'));
        btn.setAttribute('aria-pressed','true');
        activeTab = btn.dataset.tab;
        render();
      });
    });

    // Search
    searchInput.addEventListener('input', ()=>{
      query = searchInput.value.trim();
      render();
    });

    // Load data (with one-tab session cache)
    const cacheKey = 'media_cache_v1';
    const cached = sessionStorage.getItem(cacheKey);
    if (cached) {
      try { all = JSON.parse(cached); } catch {}
    }

    fetch(DATA_URL, {cache:'no-store'}).then(r=>{
      if (!r.ok) throw new Error('Failed to load media.json');
      return r.json();
    }).then(json=>{
      all.photos = Array.isArray(json.photos) ? json.photos : [];
      all.videos = Array.isArray(json.videos) ? json.videos : [];
      sessionStorage.setItem(cacheKey, JSON.stringify(all));
      render();
    }).catch(()=>{
      // fallback placeholder
      all = {
        photos: [
          { src: "public/merch/hoodie_variants.jpg", caption:"Hoodie drop preview", tags:["merch","hoodie"] }
        ],
        videos: [
          { youtube:"dQw4w9WgXcQ", title:"Sample highlight", meta:"01:12 • Highlights" }
        ]
      };
      render();
    });

  })();
  </script>

  <!-- Your main site script (menu, clock, countdown, etc.) -->
  <script src="script.js" defer></script>
</body>
</html>
