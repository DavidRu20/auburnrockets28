<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AHS Class of ’28 — Announcements</title>
  <meta name="theme-color" content="#0d6efd" />
  <link rel="stylesheet" href="styles.css?v=27" />
  <style>
    body { color: var(--text); background: transparent; overflow-x:hidden; }
    #starfield{ position: fixed; inset:0; z-index:-1; }
    main{ max-width: 1100px; margin: 0 auto; padding: 26px 18px 44px; }
    .ann-list{ display:grid; gap:14px; }
    .ann.card{ padding:16px; }
    .ann-title{ font-weight:900; font-size:1.1rem; margin:0 0 6px; }
    .ann-meta{ font-size:12px; color:var(--muted); margin-bottom:10px; }
    .ann-content p{ margin: 0 0 10px; }
    .toolbar{ display:flex; gap:10px; align-items:center; margin:12px 0 18px; }
    .toolbar .input{ max-width:360px; }
    .empty{ text-align:center; opacity:.85; padding:24px 10px; border:1px dashed var(--border); border-radius:14px; }
  </style>
</head>
<body>
  <canvas id="starfield"></canvas>

  <!-- Header / Nav -->
  <header class="header" role="banner">
    <nav class="nav" aria-label="Primary">
      <a class="brand" href="./" aria-label="AHS Class of 2028 — Home">
        <span class="logo" aria-hidden="true">A</span>
        AHS Class of ’28
      </a>
      <div class="links" role="navigation">
        <a href="./">Home</a>
        <a href="./fundraisers.html">Fundraisers</a>
        <a href="./calendar.html">Calendar</a>
        <a href="./media.html">Media</a>
        <a href="./achievements.html">Achievements</a>
        <a href="./about.html">About</a>
        <a href="./contact.html">Contact</a>
        <a href="./shop.html">Shop</a>
        <a class="active" href="./announcements.html">Announcements</a>
        <a href="./community.html">Community</a>
      </div>
      <button id="menuBtn" class="menu-btn" aria-expanded="false" aria-controls="mobileMenu" aria-label="Open menu">☰</button>
    </nav>
    <div id="mobileMenu" class="mobile-menu hidden" role="dialog" aria-modal="true" aria-label="Mobile navigation">
      <a href="./">Home</a>
      <a href="./fundraisers.html">Fundraisers</a>
      <a href="./calendar.html">Calendar</a>
      <a href="./media.html">Media</a>
      <a href="./achievements.html">Achievements</a>
      <a href="./about.html">About</a>
      <a href="./contact.html">Contact</a>
      <a href="./shop.html">Shop</a>
      <a class="active" href="./announcements.html">Announcements</a>
      <a href="./community.html">Community</a>
      <div class="small" style="padding:8px 10px; opacity:.8">Tap outside to close</div>
    </div>
  </header>

  <main>
    <h1>Announcements</h1>

    <!-- simple tools -->
    <div class="toolbar">
      <input id="q" class="input" type="search" placeholder="Search announcements…" aria-label="Search announcements">
    </div>

    <div id="list" class="ann-list"></div>
    <div id="empty" class="empty hidden">No announcements found.</div>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="small">Edit announcements in <code>data/announcements.json</code></div>
    </div>
  </footer>

  <script>
    /* Mobile menu */
    (function(){
      const btn = document.getElementById('menuBtn');
      const menu = document.getElementById('mobileMenu');
      if (!btn || !menu) return;
      btn.addEventListener('click', e=>{
        e.stopPropagation();
        const hidden = menu.classList.toggle('hidden');
        btn.setAttribute('aria-expanded', String(!hidden));
      });
      document.addEventListener('click', e=>{
        if (!menu.classList.contains('hidden') && !menu.contains(e.target) && e.target !== btn){
          btn.setAttribute('aria-expanded','false'); menu.classList.add('hidden');
        }
      });
    })();

    /* Starfield */
    (function(){
      const cvs = document.getElementById('starfield');
      const ctx = cvs.getContext('2d', { alpha:false });
      let stars=[];
      function resize(){ cvs.width=innerWidth; cvs.height=innerHeight;
        stars = Array.from({length:200},()=>({x:Math.random()*cvs.width,y:Math.random()*cvs.height,r:Math.random()*1.6,v:Math.random()*0.3+0.05}));
      }
      addEventListener('resize', resize); resize();
      (function tick(){
        const light = document.documentElement.getAttribute('data-theme')==='light';
        const g = ctx.createLinearGradient(0,0,0,cvs.height);
        if(light){ g.addColorStop(0,'#eaf2ff'); g.addColorStop(1,'#ffffff'); }
        else{ g.addColorStop(0,'#0b0e1a'); g.addColorStop(1,'#000'); }
        ctx.fillStyle=g; ctx.fillRect(0,0,cvs.width,cvs.height);
        ctx.fillStyle = light? 'rgba(60,90,140,.85)':'rgba(180,200,255,.85)';
        for(const s of stars){ ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill(); s.y+=s.v; if(s.y>cvs.height){ s.y=-2; s.x=Math.random()*cvs.width; } }
        requestAnimationFrame(tick);
      })();
    })();

    /* Announcements loader */
    const SOURCE = 'data/announcements.json';
    const listEl = document.getElementById('list');
    const emptyEl = document.getElementById('empty');
    const q = document.getElementById('q');
    let ANN = [];

    function mdToHTML(s){
      // very tiny markdown: links + paragraphs + line breaks
      if(!s) return '';
      let html = s
        .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); // basic escape
      html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2">$1</a>'); // links
      html = html.replace(/\n{2,}/g, '</p><p>'); // paragraphs
      html = '<p>'+html.replace(/\n/g,'<br>')+'</p>'; // single line breaks
      return html;
    }

    function render(){
      const term = (q.value||'').toLowerCase().trim();
      const filtered = ANN.filter(a=>{
        const hay = (a.title+' '+a.content).toLowerCase();
        return !term || hay.includes(term);
      }).sort((a,b)=> b.date.localeCompare(a.date)); // newest first (YYYY-MM-DD)

      listEl.innerHTML = '';
      if (!filtered.length){ emptyEl.classList.remove('hidden'); return; }
      emptyEl.classList.add('hidden');

      filtered.forEach(a=>{
        const card = document.createElement('article');
        card.className = 'card hover-up ann';

        const title = document.createElement('h3');
        title.className = 'ann-title';
        title.textContent = a.title || 'Untitled';

        const meta = document.createElement('div');
        meta.className = 'ann-meta';
        meta.textContent = new Date(a.date).toLocaleDateString();

        const body = document.createElement('div');
        body.className = 'ann-content';
        body.innerHTML = mdToHTML(a.content || '');

        card.appendChild(title);
        card.appendChild(meta);
        card.appendChild(body);
        listEl.appendChild(card);
      });
    }

    q.addEventListener('input', render);

    fetch(SOURCE, { cache:'no-store' })
      .then(r=> r.ok ? r.json() : [])
      .then(data => { ANN = Array.isArray(data) ? data : []; render(); })
      .catch(()=>{ ANN = []; render(); });
  </script>

  <script src="script.js?v=27"></script>
</body>
</html>

