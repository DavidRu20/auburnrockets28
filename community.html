<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Community â€¢ AHS Class of â€™28</title>
  <meta name="theme-color" content="#0d6efd" />
  <link rel="stylesheet" href="styles.css" />

  <style>
    /* --- Header hardening: consistent nav (matches other pages) --- */
    .nav{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .links{ display:flex; align-items:center; gap:16px; white-space:nowrap; }
    .menu-btn{ display:none; }
    @media (max-width:980px){
      .header .links{ display:none; }
      .menu-btn{
        display:inline-flex; align-items:center; justify-content:center;
        width:42px; height:42px; border-radius:12px; border:1px solid var(--border);
        background:var(--panel);
      }
    }
    .mobile-menu{
      position:fixed; inset:64px 10px auto 10px; z-index:9999;
      background:var(--panel); border:1px solid var(--border);
      border-radius:14px; box-shadow:var(--shadow-2); padding:12px;
      backdrop-filter:blur(10px);
    }
    .mobile-menu a{ display:block; padding:12px 10px; border-radius:10px; color:var(--text); }
    .mobile-menu a:hover{ background:rgba(255,255,255,.06); }
    .hidden{ display:none !important; }
    html.menu-open, body.menu-open { overflow:hidden; }

    /* Page base */
    html, body { max-width:100%; overflow-x:hidden; }
    body{ color:var(--text); background:transparent; }
    #starfield{ position:fixed; inset:0; z-index:-1; pointer-events:none; display:block; }

    /* Futuristic deck */
    .wrap{ width:min(1200px, 96vw); margin-inline:auto; padding:28px 0 44px; }
    .heroX{
      display:grid; gap:10px; justify-items:center; text-align:center;
      padding:80px 12px 30px;
    }
    .heroX h1{ font-size:clamp(2.1rem, 4.5vw, 3.2rem); margin:0; letter-spacing:.4px; }
    .heroX .sub{ opacity:.9; margin:4px 0 0; }

    /* Tabs */
    .tabs{
      display:flex; gap:10px; justify-content:center; margin: 12px auto 24px;
      position:sticky; top:64px; z-index:5; padding:6px 6px;
      background:rgba(255,255,255,.04); border:1px solid var(--border); border-radius:999px;
      backdrop-filter:blur(8px);
      width:max-content; max-width:100%;
    }
    .tab{
      border:1px solid var(--border); border-radius:999px; padding:8px 14px; cursor:pointer;
      background:var(--panel); font-weight:800; letter-spacing:.2px;
      transition: transform var(--t-base), background var(--t-base), box-shadow var(--t-base);
      box-shadow:var(--shadow-1);
    }
    .tab[aria-selected="true"]{
      background:linear-gradient(135deg,#0d6efd,#2b8cff);
      color:#fff; border-color:transparent; transform:translateY(-1px);
      box-shadow:0 8px 24px rgba(13,110,253,.30);
    }

    /* Panels */
    .grid-2x{ display:grid; gap:18px; grid-template-columns:repeat(2,minmax(0,1fr)); }
    @media (max-width:900px){ .grid-2x{ grid-template-columns:1fr; } }

    /* Neo-glass panel */
    .neo{
      border-radius:22px; padding:18px; position:relative;
      background: radial-gradient(1000px 450px at -10% -20%, rgba(13,110,253,.18), transparent 60%),
                  radial-gradient(600px 300px at 110% 120%, rgba(255,255,255,.06), transparent 60%),
                  rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 10px 40px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
    }
    .neo h2{ margin:6px 0 8px; }

    /* Embeds */
    .embed{ aspect-ratio: 16/10; border-radius:14px; overflow:hidden; border:1px solid var(--border); background:var(--panel); }
    .embed iframe{ width:100%; height:100%; border:0; display:block; }

    /* Buttons row (open links) */
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:8px; }
    .row .spacer{ flex:1 1 auto; }
    .btn.small{ height:36px; padding:0 12px; font-weight:800; }
    .btn.glow{ box-shadow:0 8px 28px rgba(13,110,253,.33); }

    /* Divider text */
    .divider{ text-align:center; opacity:.85; margin:4px 0 18px; font-weight:800; letter-spacing:.25px; }

    /* Demo poll */
    .choices{ display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
    .progress-rail{
      height:10px; border-radius:999px; background:rgba(255,255,255,.10);
      overflow:hidden; position:relative; border:1px solid rgba(255,255,255,.12);
    }
    .progress-fill{ height:100%; width:0%; background: linear-gradient(90deg,#52a8ff,#7ab8ff); position:relative; }
    .progress-fill .ship{ position:absolute; right:-12px; top:-12px; filter: drop-shadow(0 0 8px rgba(255,255,255,.35)); }
    .stat-row{ display:flex; align-items:center; justify-content:space-between; gap:10px; font-weight:700; margin-top:6px; }
    .stat-row .pct{ opacity:.9; }

    .help{ border-radius:16px; padding:12px; border:1px dashed var(--border); background:rgba(255,255,255,.04); color:var(--muted); }
  </style>
</head>
<body>

  <canvas id="starfield" aria-hidden="true"></canvas>

  <!-- ============================ HEADER / NAV ============================ -->
  <header class="header" role="banner">
    <nav class="nav" aria-label="Primary">
      <a class="brand" href="./index.html" aria-label="AHS Class of 2028 â€” Home">
        <span class="logo" aria-hidden="true">A</span>
        AHS Class of â€™28
      </a>

      <div class="links" role="navigation">
        <a href="./index.html">Home</a>
        <a href="./fundraisers.html">Fundraisers</a>
        <a href="./calendar.html">Calendar</a>
        <a href="./media.html">Media</a>
        <a href="./achievements.html">Achievements</a>
        <a href="./about.html">About</a>
        <a href="./contact.html">Contact</a>
        <a href="./shop.html">Shop</a>
        <a href="./announcements.html">Announcements</a>
        <a class="active" href="./community.html" aria-current="page">Community</a>
      </div>

      <button id="menuBtn" class="menu-btn" aria-expanded="false"
              aria-controls="mobileMenu" aria-label="Open menu">â˜°</button>
    </nav>

    <div id="mobileMenu" class="mobile-menu hidden" role="dialog" aria-modal="true" aria-label="Mobile navigation">
      <a href="./index.html">Home</a>
      <a href="./fundraisers.html">Fundraisers</a>
      <a href="./calendar.html">Calendar</a>
      <a href="./media.html">Media</a>
      <a href="./achievements.html">Achievements</a>
      <a href="./about.html">About</a>
      <a href="./contact.html">Contact</a>
      <a href="./shop.html">Shop</a>
      <a href="./announcements.html">Announcements</a>
      <a class="active" href="./community.html" aria-current="page">Community</a>
      <div class="small" style="padding:8px 10px; opacity:.8">Tap outside to close</div>
    </div>
  </header>

  <main class="wrap">
    <!-- HERO -->
    <section class="heroX">
      <h1>Community Voting</h1>
      <div class="sub">Make decisions together. Live form + live results for everyone.</div>
    </section>

    <!-- TABS -->
    <div class="tabs" role="tablist" aria-label="Community tabs">
      <button id="tabLive" class="tab" role="tab" aria-selected="true" aria-controls="panelLive">Live Poll</button>
      <button id="tabDemo" class="tab" role="tab" aria-selected="false" aria-controls="panelDemo">Quick Demo</button>
    </div>

    <!-- ===== PANEL: LIVE POLL (admin-configured) ===== -->
    <section id="panelLive" role="tabpanel" aria-labelledby="tabLive">
      <div class="grid-2x">
        <article class="neo">
          <h2>Vote Here</h2>
          <div class="embed" style="margin-top:12px;">
            <iframe id="formFrame" title="Class Vote Form (Google)"></iframe>
          </div>
          <div class="row">
            <span class="spacer"></span>
            <a id="openFormBtn" class="btn small glow" target="_blank" rel="noopener">Open in new tab</a>
          </div>
          <div id="formHelp" class="help hidden" style="margin-top:12px;">
            Admin: set <code>FORM_URL</code> in the script near the bottom of this file to your Google Form link.
          </div>
        </article>

        <article class="neo">
          <h2>Live Results</h2>
          <div class="embed" style="margin-top:12px;">
            <iframe id="chartFrame" title="Live Results (Google Sheets)"></iframe>
          </div>
          <div class="row">
            <span class="spacer"></span>
            <a id="openChartBtn" class="btn small glow" target="_blank" rel="noopener">Open in new tab</a>
          </div>
          <div id="chartHelp" class="help hidden" style="margin-top:12px;">
            Admin: set <code>CHART_URL</code> in the script to a published chart URL from Google Sheets.
          </div>
        </article>
      </div>
    </section>

    <!-- ===== PANEL: DEMO POLL (optional, local only) ===== -->
    <section id="panelDemo" class="hidden" role="tabpanel" aria-labelledby="tabDemo">
      <article class="neo">
        <h2>Quick Demo Poll</h2>
        <p class="help">This is just for testing on your device. Votes save locally in your browser.</p>

        <div class="divider">Question</div>
        <div class="row" style="margin-bottom:10px;">
          <div class="input" style="flex:1 1 460px;"><input id="demoQuestion" type="text" placeholder="Which merch should we drop first?"></div>
          <button class="btn small" id="btnSetQ">Set</button>
          <button class="btn small" id="btnResetAll">Reset All</button>
        </div>

        <div id="choicesWrap" class="choices"></div>

        <div class="divider">Results</div>
        <div id="resultsWrap" class="card-list"></div>

        <div class="row" style="margin-top:12px;">
          <button class="btn" id="btnAddChoice">Add choice</button>
          <button class="btn" id="btnResetVotes">Reset my demo votes</button>
          <div class="small" id="votesLeftNote" style="margin-left:auto; color:var(--muted)"></div>
        </div>
      </article>
    </section>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="small">AHS Class of â€™28 â€¢ Community Voting</div>
    </div>
  </footer>

  <div id="toast" class="toast info hidden" role="status" aria-live="polite"></div>

  <!-- ===== Mobile menu ===== -->
  <script>
    (function(){
      const btn  = document.getElementById('menuBtn');
      const menu = document.getElementById('mobileMenu');
      if (!btn || !menu) return;
      if (btn.dataset.bound === "1") return;
      btn.dataset.bound = "1";

      const DESKTOP_W = 980;
      let open = false;
      function setOpen(v){
        open = v;
        menu.classList.toggle('hidden', !open);
        btn.setAttribute('aria-expanded', String(open));
        document.documentElement.classList.toggle('menu-open', open);
        document.body.classList.toggle('menu-open', open);
      }
      btn.addEventListener('click', (e)=>{ e.stopPropagation(); setOpen(!open); }, {passive:true});
      document.addEventListener('click', (e)=>{ if(open && !menu.contains(e.target) && e.target !== btn) setOpen(false); });
      document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') setOpen(false); });
      menu.addEventListener('click', (e)=>{ if (e.target.closest('a')) setOpen(false); });
      window.addEventListener('resize', ()=>{ if (innerWidth > DESKTOP_W) setOpen(false); });
    })();
  </script>

  <!-- ===== Tabs + Admin-config embeds + Demo logic ===== -->
  <script>
    (function(){
      /* ---------- CONFIG: set your URLs here ---------- */
      const FORM_URL  = ""; // PUT YOUR GOOGLE FORM LINK HERE
      const CHART_URL = ""; // PUT YOUR PUBLISHED GOOGLE SHEETS CHART LINK HERE

      /* ---------- Tabs ---------- */
      const tabLive = document.getElementById('tabLive');
      const tabDemo = document.getElementById('tabDemo');
      const panelLive = document.getElementById('panelLive');
      const panelDemo = document.getElementById('panelDemo');
      function select(tab){
        const live = (tab === 'live');
        tabLive.setAttribute('aria-selected', live ? 'true':'false');
        tabDemo.setAttribute('aria-selected', !live ? 'true':'false');
        panelLive.classList.toggle('hidden', !live);
        panelDemo.classList.toggle('hidden', live);
      }
      tabLive.addEventListener('click', ()=> select('live'));
      tabDemo.addEventListener('click', ()=> select('demo'));

      /* ---------- Live Poll Embeds ---------- */
      const formFrame  = document.getElementById('formFrame');
      const chartFrame = document.getElementById('chartFrame');
      const openForm   = document.getElementById('openFormBtn');
      const openChart  = document.getElementById('openChartBtn');
      const formHelp   = document.getElementById('formHelp');
      const chartHelp  = document.getElementById('chartHelp');

      function safeURL(u){ try{ return u ? new URL(u).href : ""; }catch{ return ""; } }

      const f = safeURL(FORM_URL);
      const c = safeURL(CHART_URL);
      if (f) { formFrame.src = f; openForm.href = f; }
      else { formHelp.classList.remove('hidden'); openForm.classList.add('hidden'); }

      if (c) { chartFrame.src = c; openChart.href = c; }
      else { chartHelp.classList.remove('hidden'); openChart.classList.add('hidden'); }

      /* ---------- Demo Poll (local only) ---------- */
      const KEY_DEMO_DATA = 'ahs28_demo_data_v3';
      const KEY_DEMO_Q    = 'ahs28_demo_q_v3';
      const KEY_VOTES     = 'ahs28_demo_votes_left_v3';
      const MAX_VOTES     = 10;

      const qInput   = document.getElementById('demoQuestion');
      const btnSetQ  = document.getElementById('btnSetQ');
      const btnAdd   = document.getElementById('btnAddChoice');
      const btnReset = document.getElementById('btnResetVotes');
      const btnResetAll = document.getElementById('btnResetAll');
      const votesLeftNote = document.getElementById('votesLeftNote');
      const choicesWrap = document.getElementById('choicesWrap');
      const resultsWrap = document.getElementById('resultsWrap');

      const toast = document.getElementById('toast');
      function showToast(msg, cls='info'){
        toast.textContent = msg;
        toast.className = 'toast ' + cls;
        toast.classList.remove('hidden');
        setTimeout(()=> toast.classList.add('hidden'), 1600);
      }

      function readObj(key, fallback){ try{ return JSON.parse(localStorage.getItem(key)) ?? fallback; }catch{ return fallback; } }
      function writeObj(key, v){ localStorage.setItem(key, JSON.stringify(v)); }
      function votesLeft(){ const v = parseInt(localStorage.getItem(KEY_VOTES),10); return Number.isFinite(v)?v:MAX_VOTES; }
      function setVotesLeft(v){ localStorage.setItem(KEY_VOTES, String(v)); }

      function renderChoices(){
        const data = readObj(KEY_DEMO_DATA, {});
        choicesWrap.innerHTML='';
        Object.keys(data).forEach(name=>{
          const b = document.createElement('button');
          b.className = 'btn';
          b.textContent = name;
          b.addEventListener('click', ()=>{
            let left = votesLeft();
            if(left<=0){ showToast('Youâ€™ve used all your votes!','warn'); return; }
            data[name] = (data[name]||0)+1; writeObj(KEY_DEMO_DATA, data);
            setVotesLeft(--left); renderResults();
          });
          choicesWrap.appendChild(b);
        });
        if (!Object.keys(data).length){
          const none = document.createElement('div');
          none.className = 'help';
          none.textContent = 'Add choices to start voting.';
          choicesWrap.appendChild(none);
        }
      }

      function renderResults(){
        const data = readObj(KEY_DEMO_DATA, {});
        const total = Object.values(data).reduce((a,b)=>a+b,0);
        resultsWrap.innerHTML='';
        Object.keys(data).forEach(name=>{
          const count = data[name]||0;
          const pct = total? Math.round(count*100/total):0;
          const card = document.createElement('div');
          card.className = 'card-item';
          card.innerHTML = `
            <div class="stat-row">
              <div class="title">${name}</div>
              <div class="pct">${count} vote${count!==1?'s':''} â€¢ ${pct}%</div>
            </div>
            <div class="progress-rail">
              <div class="progress-fill" style="width:${pct}%"><span class="ship">ðŸš€</span></div>
            </div>`;
          resultsWrap.appendChild(card);
        });
        votesLeftNote.textContent = `You have ${votesLeft()} vote${votesLeft()!==1?'s':''} left.`;
      }

      function addChoice(name){
        name = (name||'').trim();
        if(!name) return;
        const data = readObj(KEY_DEMO_DATA, {});
        if (data[name] != null) { showToast('That choice already exists','warn'); return; }
        data[name] = 0; writeObj(KEY_DEMO_DATA, data);
        renderChoices(); renderResults(); showToast('Choice added','success');
      }

      btnAdd.addEventListener('click', ()=> addChoice(prompt('New choice name:')));
      btnReset.addEventListener('click', ()=>{ if(confirm('Reset your local demo votes?')){ setVotesLeft(MAX_VOTES); renderResults(); showToast('Demo votes reset'); } });
      btnResetAll.addEventListener('click', ()=>{
        if(!confirm('Reset ALL demo data (question, choices, votes)?')) return;
        writeObj(KEY_DEMO_DATA, {});
        writeObj(KEY_DEMO_Q, 'Which merch should we drop first?');
        setVotesLeft(MAX_VOTES);
        initDemo(); showToast('Demo cleared','success');
      });
      btnSetQ.addEventListener('click', ()=>{
        const v = qInput.value.trim(); if(!v) return showToast('Type a question first','warn');
        writeObj(KEY_DEMO_Q, v); showToast('Question saved','success');
      });

      function initDemo(){
        const q = readObj(KEY_DEMO_Q, 'Which merch should we drop first?');
        qInput.value = q;
        if (localStorage.getItem(KEY_VOTES) === null) setVotesLeft(MAX_VOTES);
        const data = readObj(KEY_DEMO_DATA, {});
        if (!Object.keys(data).length){
          writeObj(KEY_DEMO_DATA, { 'Hoodie':0, 'Script Tee':0, 'Basketball Jersey':0, 'Striped Polo':0 });
        }
        renderChoices(); renderResults();
      }
      initDemo();
    })();
  </script>

  <!-- ===== Starfield (same as other pages) ===== -->
  <script>
    (function(){
      const cvs = document.getElementById('starfield');
      const ctx = cvs.getContext('2d', { alpha:false });
      let stars=[];
      function resize(){
        cvs.width = innerWidth; cvs.height = innerHeight;
        stars = Array.from({length:220},()=>({
          x:Math.random()*cvs.width, y:Math.random()*cvs.height,
          r:Math.random()*1.6, v:Math.random()*0.3+0.05
        }));
      }
      addEventListener('resize', resize); resize();
      (function tick(){
        const light = document.documentElement.getAttribute('data-theme')==='light';
        const g = ctx.createLinearGradient(0,0,0,cvs.height);
        if(light){ g.addColorStop(0,'#eaf2ff'); g.addColorStop(1,'#ffffff'); }
        else{ g.addColorStop(0,'#0b0e1a'); g.addColorStop(1,'#000'); }
        ctx.fillStyle=g; ctx.fillRect(0,0,cvs.width,cvs.height);
        ctx.fillStyle = light? 'rgba(60,90,140,.85)' : 'rgba(180,200,255,.85)';
        for(const s of stars){
          ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill();
          s.y+=s.v; if(s.y>cvs.height){ s.y=-2; s.x=Math.random()*cvs.width; }
        }
        requestAnimationFrame(tick);
      })();
    })();
  </script>

  <script src="script.js" defer></script>
</body>
</html>

